<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Jerome Bustarga - Portfolio</title>
<link rel="icon" type="image/png" href="images/favicon.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  -webkit-tap-highlight-color: transparent;
}

html {
  scroll-behavior: smooth;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: #0d0d0d;
  color: #e8e8e8;
  overflow: hidden;
  line-height: 1.6;
  touch-action: none;
  position: fixed;
  width: 100%;
  height: 100%;
}

/* Lightbulb Power Button */
.lightbulb-container {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 10000;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}

body.power-on .lightbulb-container {
  top: 20px;
  left: 20px;
  transform: translate(0, 0);
  z-index: 10001;
  flex-direction: row;
  gap: 10px;
}

@media (min-width: 769px) {
  body.power-on .lightbulb-container {
    top: 40px;
    left: 60px;
    gap: 15px;
  }
}

.logo-wrapper {
  display: none;
  align-items: center;
  gap: 10px;
}

body.power-on .logo-wrapper {
  display: flex;
}

.lightbulb {
  width: 35px;
  height: 35px;
  position: relative;
}

@media (min-width: 769px) {
  .lightbulb {
    width: 50px;
    height: 50px;
  }
}

.bulb-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
}

.bulb-off {
  display: block;
}

.bulb-on {
  display: none;
  filter: drop-shadow(0 0 40px rgba(244, 121, 33, 0.8)) drop-shadow(0 0 80px rgba(244, 121, 33, 0.5));
}

body.power-on .bulb-off {
  display: none;
}

body.power-on .bulb-on {
  display: block;
}

.logo-name {
  font-size: 14px;
  font-weight: 600;
  color: #e8e8e8;
  letter-spacing: 1px;
  white-space: nowrap;
}

@media (min-width: 769px) {
  .logo-name {
    font-size: 20px;
  }
}

.start-button {
  padding: 16px 50px;
  background: rgba(244, 121, 33, 0.1);
  border: 2px solid rgba(244, 121, 33, 0.4);
  color: #f47921;
  font-size: 18px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  backdrop-filter: blur(10px);
}

.start-button:hover {
  background: rgba(244, 121, 33, 0.2);
  border-color: rgba(244, 121, 33, 0.6);
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(244, 121, 33, 0.3);
}

.start-button:active {
  transform: scale(0.98);
}

body.power-on .start-button {
  display: none;
}

#gameContainer {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 2;
  padding: 10px;
  padding-bottom: 180px; /* Space for mobile controls */
}

@media (min-width: 769px) {
  #gameContainer {
    padding-bottom: 10px;
  }
}

body.power-on #gameContainer {
  display: flex;
}

#gameContainer.hide-cursor,
#gameContainer.hide-cursor * {
  cursor: none !important;
}

.game-arena {
  position: relative;
  width: 100%;
  max-width: 1200px;
  height: 100%;
  max-height: 500px;
  background: rgba(20, 20, 20, 0.6);
  border: 2px solid rgba(244, 121, 33, 0.2);
  border-radius: 12px;
  backdrop-filter: blur(20px);
  overflow: hidden;
  box-shadow: 0 0 60px rgba(244, 121, 33, 0.1);
  pointer-events: none;
}

@media (min-width: 769px) {
  .game-arena {
    border-radius: 20px;
    max-height: 70vh;
  }
}

.character {
  position: absolute;
  width: 30px;
  height: 45px;
  transition: none;
  z-index: 100;
}

@media (min-width: 769px) {
  .character {
    width: 40px;
    height: 60px;
  }
}

/* MAIN LEVEL - GRID BASED PLATFORMER */
.main-level {
  width: 100%;
  height: 100%;
  display: none;
}

.main-level.active {
  display: grid;
  grid-template-columns: repeat(30, 1fr);
  grid-template-rows: repeat(20, 1fr);
  gap: 0px;
  background: rgba(244, 121, 33, 0.1);
}

@media (min-width: 769px) {
  .main-level.active {
    gap: 1px;
  }
}

.main-grid-cell {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
}

@media (min-width: 769px) {
  .main-grid-cell {
    border: 1px solid rgba(244, 121, 33, 0.15);
  }
}

.main-grid-cell.wall {
  background: linear-gradient(135deg, #f47921, #d96a1a);
  border: 1px solid #c25a15;
  box-shadow: inset 0 0.5px 1px rgba(255, 255, 255, 0.2),
              inset 0 -0.5px 1px rgba(0, 0, 0, 0.3);
  z-index: 1;
}

.main-grid-cell.path {
  background: transparent;
  border: none;
}

/* Doors */
.door {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  pointer-events: none;
  z-index: 50;
}

@media (min-width: 769px) {
  .door {
    flex-direction: row;
    gap: 12px;
  }
}

.door-icon {
  font-size: 28px;
  color: #f47921;
  transition: all 0.3s ease;
  line-height: 1;
}

@media (min-width: 769px) {
  .door-icon {
    font-size: 52px;
  }
}

.door.can-enter .door-icon {
  text-shadow: 0 0 30px rgba(244, 121, 33, 0.8),
               0 0 60px rgba(244, 121, 33, 0.6),
               0 0 90px rgba(244, 121, 33, 0.4);
  animation: iconPulse 0.8s ease-in-out infinite;
}

@keyframes iconPulse {
  0%, 100% {
    text-shadow: 0 0 30px rgba(244, 121, 33, 0.8),
                 0 0 60px rgba(244, 121, 33, 0.6),
                 0 0 90px rgba(244, 121, 33, 0.4);
  }
  50% {
    text-shadow: 0 0 40px rgba(244, 121, 33, 1),
                 0 0 80px rgba(244, 121, 33, 0.8),
                 0 0 120px rgba(244, 121, 33, 0.6);
  }
}

.door-label {
  font-size: 8px;
  font-weight: 600;
  color: #f47921;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  line-height: 1;
  transition: all 0.3s ease;
}

@media (min-width: 769px) {
  .door-label {
    font-size: 11px;
    letter-spacing: 1.2px;
  }
}

.door.can-enter .door-label {
  text-shadow: 0 0 10px rgba(244, 121, 33, 0.6);
}

/* STUDIO LEVEL - GRID BASED MAZE */
.studio-level {
  display: none;
  width: 100%;
  height: 100%;
}

.studio-level.active {
  display: grid;
  grid-template-columns: repeat(30, 1fr);
  grid-template-rows: repeat(20, 1fr);
  gap: 0px;
  background: rgba(244, 121, 33, 0.1);
}

@media (min-width: 769px) {
  .studio-level.active {
    gap: 1px;
  }
}

.grid-cell {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
}

@media (min-width: 769px) {
  .grid-cell {
    border: 1px solid rgba(244, 121, 33, 0.15);
  }
}

.grid-cell.wall {
  background: linear-gradient(135deg, #f47921, #d96a1a);
  border: 1px solid #c25a15;
  box-shadow: inset 0 0.5px 1px rgba(255, 255, 255, 0.2),
              inset 0 -0.5px 1px rgba(0, 0, 0, 0.3);
  z-index: 1;
}

.grid-cell.path {
  background: transparent;
  border: none;
}

/* Studio Doors */
.studio-door {
  position: absolute;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 4px;
  pointer-events: none;
  z-index: 50;
}

@media (min-width: 769px) {
  .studio-door {
    flex-direction: row;
    gap: 12px;
  }
}

.studio-door-icon {
  font-size: 28px;
  color: #f47921;
  transition: all 0.3s ease;
  line-height: 1;
}

@media (min-width: 769px) {
  .studio-door-icon {
    font-size: 52px;
  }
}

.studio-door.can-enter .studio-door-icon {
  text-shadow: 0 0 30px rgba(244, 121, 33, 0.8),
               0 0 60px rgba(244, 121, 33, 0.6),
               0 0 90px rgba(244, 121, 33, 0.4);
  animation: iconPulse 0.8s ease-in-out infinite;
}

.studio-door-label {
  font-size: 8px;
  font-weight: 600;
  color: #f47921;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  white-space: nowrap;
  line-height: 1;
}

@media (min-width: 769px) {
  .studio-door-label {
    font-size: 11px;
    letter-spacing: 1.2px;
  }
}

.studio-door.can-enter .studio-door-label {
  text-shadow: 0 0 10px rgba(244, 121, 33, 0.6);
}

.game-instructions {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  text-align: center;
  color: rgba(244, 121, 33, 0.7);
  font-size: 10px;
  letter-spacing: 0.5px;
  animation: fadeOutInstructions 4s ease-in-out forwards;
  z-index: 1000;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
  width: 90%;
}

@media (min-width: 769px) {
  .game-instructions {
    font-size: 14px;
    letter-spacing: 1px;
    bottom: 30px;
  }
}

@keyframes fadeOutInstructions {
  0% { opacity: 1; }
  75% { opacity: 1; }
  100% { opacity: 0; visibility: hidden; }
}

.key-hint {
  display: inline-block;
  background: rgba(244, 121, 33, 0.15);
  border: 1px solid rgba(244, 121, 33, 0.4);
  padding: 2px 6px;
  border-radius: 4px;
  margin: 0 2px;
  font-family: 'Courier New', monospace;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  font-size: 9px;
}

@media (min-width: 769px) {
  .key-hint {
    padding: 4px 10px;
    font-size: inherit;
  }
}

.entrance-prompt {
  position: absolute;
  top: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(244, 121, 33, 0.95);
  color: #0d0d0d;
  padding: 4px 8px;
  border-radius: 4px;
  font-size: 9px;
  font-weight: 600;
  letter-spacing: 0.5px;
  white-space: nowrap;
  opacity: 0;
  transition: opacity 0.3s ease;
  pointer-events: none;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  z-index: 60;
}

@media (min-width: 769px) {
  .entrance-prompt {
    top: -40px;
    padding: 6px 12px;
    font-size: 11px;
    letter-spacing: 1px;
  }
}

.door.can-enter .entrance-prompt,
.studio-door.can-enter .entrance-prompt {
  opacity: 1;
  animation: bounce 0.6s ease-in-out infinite;
}

@keyframes bounce {
  0%, 100% { transform: translate(-50%, 0); }
  50% { transform: translate(-50%, -8px); }
}

/* ========== MOBILE TOUCH CONTROLS ========== */
.mobile-controls {
  display: none;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  height: 170px;
  background: linear-gradient(to top, rgba(13, 13, 13, 0.95), rgba(13, 13, 13, 0.8));
  z-index: 10000;
  padding: 15px 20px;
  border-top: 1px solid rgba(244, 121, 33, 0.2);
}

body.power-on .mobile-controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

@media (min-width: 769px) {
  body.power-on .mobile-controls {
    display: none;
  }
}

/* D-Pad */
.dpad-container {
  position: relative;
  width: 130px;
  height: 130px;
}

.dpad-btn {
  position: absolute;
  width: 45px;
  height: 45px;
  background: rgba(244, 121, 33, 0.15);
  border: 2px solid rgba(244, 121, 33, 0.4);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #f47921;
  font-size: 18px;
  transition: all 0.1s ease;
  user-select: none;
  -webkit-user-select: none;
}

.dpad-btn:active,
.dpad-btn.active {
  background: rgba(244, 121, 33, 0.4);
  border-color: #f47921;
  transform: scale(0.95);
  box-shadow: 0 0 20px rgba(244, 121, 33, 0.5);
}

.dpad-up {
  top: 0;
  left: 50%;
  transform: translateX(-50%);
}

.dpad-down {
  bottom: 0;
  left: 50%;
  transform: translateX(-50%);
}

.dpad-left {
  left: 0;
  top: 50%;
  transform: translateY(-50%);
}

.dpad-right {
  right: 0;
  top: 50%;
  transform: translateY(-50%);
}

.dpad-center {
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 35px;
  height: 35px;
  background: rgba(244, 121, 33, 0.1);
  border: 1px solid rgba(244, 121, 33, 0.2);
  border-radius: 50%;
}

/* Action Button */
.action-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.action-btn {
  width: 80px;
  height: 80px;
  background: rgba(244, 121, 33, 0.2);
  border: 3px solid rgba(244, 121, 33, 0.5);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #f47921;
  font-size: 14px;
  font-weight: 700;
  letter-spacing: 1px;
  text-transform: uppercase;
  transition: all 0.1s ease;
  user-select: none;
  -webkit-user-select: none;
  box-shadow: 0 4px 15px rgba(244, 121, 33, 0.2);
}

.action-btn:active,
.action-btn.active {
  background: rgba(244, 121, 33, 0.5);
  border-color: #f47921;
  transform: scale(0.95);
  box-shadow: 0 0 30px rgba(244, 121, 33, 0.6);
}

.action-btn.can-enter {
  animation: actionPulse 1s ease-in-out infinite;
}

@keyframes actionPulse {
  0%, 100% {
    box-shadow: 0 4px 15px rgba(244, 121, 33, 0.2);
  }
  50% {
    box-shadow: 0 4px 30px rgba(244, 121, 33, 0.6);
  }
}

.action-label {
  font-size: 10px;
  color: rgba(244, 121, 33, 0.6);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* Level indicator */
.level-indicator {
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(244, 121, 33, 0.15);
  border: 1px solid rgba(244, 121, 33, 0.3);
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 10px;
  color: #f47921;
  text-transform: uppercase;
  letter-spacing: 1px;
  z-index: 100;
}

@media (min-width: 769px) {
  .level-indicator {
    padding: 6px 14px;
    font-size: 12px;
  }
}

footer {
  position: fixed;
  bottom: 180px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10002;
  font-size: 10px;
  color: rgba(244, 121, 33, 0.5);
  letter-spacing: 1px;
  display: none;
}

@media (min-width: 769px) {
  footer {
    bottom: 20px;
    font-size: 12px;
  }
}

body.power-on footer {
  display: block;
}
</style>
</head>
<body>

<div class="lightbulb-container" id="lightbulbContainer">
  <div class="logo-wrapper">
    <div class="lightbulb" id="lightbulb">
      <img src="logo-off.png" alt="Logo Off" class="bulb-image bulb-off" id="bulbOff">
      <img src="images/logo.png" alt="Logo On" class="bulb-image bulb-on" id="bulbOn">
    </div>
    <div class="logo-name">Jerome Bustarga</div>
  </div>
  <button class="start-button" id="startButton">Start</button>
</div>

<div id="gameContainer">
  <div class="game-arena" id="gameArena">
    <div class="level-indicator" id="levelIndicator">Main Hub</div>
    
    <div class="character" id="character">
      <canvas id="characterCanvas" width="40" height="60"></canvas>
    </div>

    <!-- MAIN LEVEL - GRID PLATFORMER -->
    <div class="main-level" id="mainLevel">
      <!-- Grid will be generated by JavaScript -->
    </div>

    <!-- STUDIO LEVEL - GRID MAZE -->
    <div class="studio-level" id="studioLevel">
      <!-- Grid will be generated by JavaScript -->
    </div>
  </div>
</div>

<!-- Mobile Touch Controls -->
<div class="mobile-controls" id="mobileControls">
  <div class="dpad-container">
    <button class="dpad-btn dpad-up" data-key="ArrowUp">
      <i class="fa-solid fa-chevron-up"></i>
    </button>
    <button class="dpad-btn dpad-down" data-key="ArrowDown">
      <i class="fa-solid fa-chevron-down"></i>
    </button>
    <button class="dpad-btn dpad-left" data-key="ArrowLeft">
      <i class="fa-solid fa-chevron-left"></i>
    </button>
    <button class="dpad-btn dpad-right" data-key="ArrowRight">
      <i class="fa-solid fa-chevron-right"></i>
    </button>
    <div class="dpad-center"></div>
  </div>
  
  <div class="action-container">
    <button class="action-btn" id="actionBtn">
      Enter
    </button>
    <span class="action-label">Door / Jump</span>
  </div>
</div>

<footer>
  © 2025 Jerome Bustarga. All rights reserved.
</footer>

<script>
const lightbulbContainer = document.getElementById('lightbulbContainer');
const startButton = document.getElementById('startButton');
const levelIndicator = document.getElementById('levelIndicator');
let isPoweredOn = false;
let isMobile = window.innerWidth < 769;

// Check if device is mobile
function checkMobile() {
  isMobile = window.innerWidth < 769 || 'ontouchstart' in window;
}
checkMobile();
window.addEventListener('resize', checkMobile);

startButton.addEventListener('click', () => {
  if (!isPoweredOn) {
    isPoweredOn = true;
    document.body.classList.add('power-on');
    
    requestAnimationFrame(() => {
      const arenaRect = gameArena.getBoundingClientRect();
      const cellWidth = arenaRect.width / 30;
      const cellHeight = arenaRect.height / 20;
      
      charX = (cellWidth * 15) - (isMobile ? 15 : 20);
      charY = (cellHeight * 10) - (isMobile ? 22 : 30);
      
      character.style.left = charX + 'px';
      character.style.top = charY + 'px';
      
      isGrounded = false;
      velocityY = 0;
      physicsActive = true;
    });
  }
});

const gameContainer = document.getElementById('gameContainer');

// Only hide cursor on desktop
if (!isMobile) {
  document.addEventListener('mousemove', (e) => {
    if (!isPoweredOn) return;
    
    const rect = gameContainer.getBoundingClientRect();
    const isInside = (
      e.clientX >= rect.left &&
      e.clientX <= rect.right &&
      e.clientY >= rect.top &&
      e.clientY <= rect.bottom
    );
    
    if (isInside) {
      gameContainer.classList.add('hide-cursor');
    } else {
      gameContainer.classList.remove('hide-cursor');
    }
  });
}

const charCanvas = document.getElementById('characterCanvas');
const charCtx = charCanvas.getContext('2d');

function drawCharacter() {
  const scale = isMobile ? 0.75 : 1;
  charCtx.clearRect(0, 0, 40, 60);
  charCtx.fillStyle = '#f47921';
  charCtx.fillRect(12 * scale, 8 * scale, 16 * scale, 16 * scale);
  charCtx.fillStyle = '#0d0d0d';
  charCtx.fillRect(15 * scale, 13 * scale, 4 * scale, 4 * scale);
  charCtx.fillRect(21 * scale, 13 * scale, 4 * scale, 4 * scale);
  charCtx.fillStyle = '#e8e8e8';
  charCtx.fillRect(10 * scale, 24 * scale, 20 * scale, 20 * scale);
  charCtx.fillStyle = '#f47921';
  charCtx.fillRect(10 * scale, 30 * scale, 20 * scale, 4 * scale);
  charCtx.fillStyle = '#a0a0a0';
  charCtx.fillRect(12 * scale, 44 * scale, 6 * scale, 12 * scale);
  charCtx.fillRect(22 * scale, 44 * scale, 6 * scale, 12 * scale);
}

drawCharacter();

const character = document.getElementById('character');
const gameArena = document.getElementById('gameArena');
const mainLevel = document.getElementById('mainLevel');
const studioLevel = document.getElementById('studioLevel');

let charX = 100;
let charY = 100;
let velocityX = 0;
let velocityY = 0;
let isGrounded = false;
let currentLevel = 'main';
let physicsActive = false;

const GRAVITY = 0.6;
const JUMP_FORCE = -14;
const MOVE_SPEED = isMobile ? 4 : 5;
const MAX_FALL_SPEED = 12;

const keys = {
  ArrowLeft: false,
  ArrowRight: false,
  ArrowUp: false,
  ArrowDown: false,
  Space: false
};

// Main level grid layout
const mainLevelGrid = [];

for (let row = 0; row < 20; row++) {
  mainLevelGrid[row] = [];
  for (let col = 0; col < 30; col++) {
    if (row === 0 || row === 19 || col === 0 || col === 29) {
      mainLevelGrid[row][col] = 1;
    }
    else if (row >= 17) {
      mainLevelGrid[row][col] = 1;
    }
    else if (col >= 3 && col <= 9 && row === 14) {
      mainLevelGrid[row][col] = 1;
    }
    else if (col >= 5 && col <= 11 && row === 10) {
      mainLevelGrid[row][col] = 1;
    }
    else if (col >= 20 && col <= 26 && row === 14) {
      mainLevelGrid[row][col] = 1;
    }
    else if (col >= 18 && col <= 24 && row === 10) {
      mainLevelGrid[row][col] = 1;
    }
    else if (col >= 13 && col <= 16 && row === 6) {
      mainLevelGrid[row][col] = 1;
    }
    else if (col >= 12 && col <= 17 && row === 13) {
      mainLevelGrid[row][col] = 1;
    }
    else {
      mainLevelGrid[row][col] = 0;
    }
  }
}

const mainDoorData = [
  { row: 12, col: 6, id: 'doorRepository', icon: 'fa-door-open', label: 'Repository', type: 'repository' },
  { row: 8, col: 21, id: 'doorStudio', icon: 'fa-door-open', label: 'Studio', type: 'studio' },
  { row: 4, col: 14, id: 'doorHome', icon: 'fa-door-closed', label: 'Home', type: 'home' },
  { row: 12, col: 23, id: 'doorAbout', icon: 'fa-user-circle', label: 'About', type: 'about' }
];

const studioMazeGrid = [];

for (let row = 0; row < 20; row++) {
  studioMazeGrid[row] = [];
  for (let col = 0; col < 30; col++) {
    if (row === 0 || row === 19 || col === 0 || col === 29) {
      studioMazeGrid[row][col] = 1;
    }
    else if ((col === 7 || col === 15 || col === 22) && (row < 6 || (row > 9 && row < 13) || row > 16)) {
      studioMazeGrid[row][col] = 1;
    }
    else if ((row === 7 || row === 14) && (col < 6 || (col > 9 && col < 14) || (col > 17 && col < 21) || col > 24)) {
      studioMazeGrid[row][col] = 1;
    }
    else {
      studioMazeGrid[row][col] = 0;
    }
  }
}

const studioDoorData = [
  { row: 4, col: 4, id: 'doorIllustrations', icon: 'fa-palette', label: 'Illustrations', type: 'illustrations' },
  { row: 11, col: 11, id: 'doorBranding', icon: 'fa-tag', label: 'Branding', type: 'branding' },
  { row: 4, col: 19, id: 'door3DArt', icon: 'fa-cube', label: '3D Art', type: '3dart' },
  { row: 4, col: 26, id: 'doorWebdesign', icon: 'fa-code', label: 'Web Design', type: 'webdesign' },
  { row: 4, col: 11, id: 'doorFilm', icon: 'fa-film', label: 'Film', type: 'film' },
  { row: 11, col: 19, id: 'doorBack', icon: 'fa-arrow-left', label: 'Back', type: 'back' }
];

function buildMainGrid() {
  mainLevel.innerHTML = '';
  
  for (let row = 0; row < mainLevelGrid.length; row++) {
    for (let col = 0; col < mainLevelGrid[row].length; col++) {
      const cell = document.createElement('div');
      cell.className = 'main-grid-cell';
      cell.dataset.row = row;
      cell.dataset.col = col;
      
      if (mainLevelGrid[row][col] === 1) {
        cell.classList.add('wall');
      } else {
        cell.classList.add('path');
      }
      
      const doorInfo = mainDoorData.find(d => d.row === row && d.col === col);
      if (doorInfo) {
        const door = document.createElement('div');
        door.className = 'door';
        door.id = doorInfo.id;
        door.dataset.type = doorInfo.type;
        
        const prompt = document.createElement('div');
        prompt.className = 'entrance-prompt';
        prompt.textContent = isMobile ? 'Tap ENTER' : 'Press SPACE';
        
        const icon = document.createElement('div');
        icon.className = 'door-icon';
        icon.innerHTML = `<i class="fa-solid ${doorInfo.icon}"></i>`;
        
        const label = document.createElement('div');
        label.className = 'door-label';
        label.textContent = doorInfo.label;
        
        door.appendChild(prompt);
        door.appendChild(icon);
        door.appendChild(label);
        cell.appendChild(door);
      }
      
      mainLevel.appendChild(cell);
    }
  }
  
  const instructions = document.createElement('div');
  instructions.className = 'game-instructions';
  if (isMobile) {
    instructions.innerHTML = `
      Use <span class="key-hint">D-PAD</span> to move • <span class="key-hint">ENTER</span> to jump/enter doors
    `;
  } else {
    instructions.innerHTML = `
      Use <span class="key-hint">←</span> <span class="key-hint">→</span> to move • <span class="key-hint">↑</span> to jump • <span class="key-hint">SPACE</span> to enter doors
    `;
  }
  mainLevel.appendChild(instructions);
}

function buildStudioGrid() {
  studioLevel.innerHTML = '';
  
  for (let row = 0; row < studioMazeGrid.length; row++) {
    for (let col = 0; col < studioMazeGrid[row].length; col++) {
      const cell = document.createElement('div');
      cell.className = 'grid-cell';
      cell.dataset.row = row;
      cell.dataset.col = col;
      
      if (studioMazeGrid[row][col] === 1) {
        cell.classList.add('wall');
      } else {
        cell.classList.add('path');
      }
      
      const doorInfo = studioDoorData.find(d => d.row === row && d.col === col);
      if (doorInfo) {
        const door = document.createElement('div');
        door.className = 'studio-door';
        door.id = doorInfo.id;
        door.dataset.type = doorInfo.type;
        
        const prompt = document.createElement('div');
        prompt.className = 'entrance-prompt';
        prompt.textContent = isMobile ? 'Tap ENTER' : 'Press SPACE';
        
        const icon = document.createElement('div');
        icon.className = 'studio-door-icon';
        icon.innerHTML = `<i class="fa-solid ${doorInfo.icon}"></i>`;
        
        const label = document.createElement('div');
        label.className = 'studio-door-label';
        label.textContent = doorInfo.label;
        
        door.appendChild(prompt);
        door.appendChild(icon);
        door.appendChild(label);
        cell.appendChild(door);
      }
      
      studioLevel.appendChild(cell);
    }
  }
  
  const instructions = document.createElement('div');
  instructions.className = 'game-instructions';
  if (isMobile) {
    instructions.innerHTML = `
      Use <span class="key-hint">D-PAD</span> to navigate • <span class="key-hint">ENTER</span> to enter doors
    `;
  } else {
    instructions.innerHTML = `
      Use <span class="key-hint">←</span> <span class="key-hint">↑</span> <span class="key-hint">↓</span> <span class="key-hint">→</span> to move • <span class="key-hint">SPACE</span> to enter doors
    `;
  }
  studioLevel.appendChild(instructions);
}

buildMainGrid();
buildStudioGrid();
mainLevel.classList.add('active');

function switchToStudioLevel() {
  currentLevel = 'studio';
  mainLevel.classList.remove('active');
  studioLevel.classList.add('active');
  levelIndicator.textContent = 'Studio';
  
  velocityX = 0;
  velocityY = 0;
  isGrounded = false;
  physicsActive = false;
  
  setTimeout(() => {
    const arenaRect = gameArena.getBoundingClientRect();
    const cellWidth = arenaRect.width / 30;
    const cellHeight = arenaRect.height / 20;
    
    charX = (cellWidth * 17) + (cellWidth / 2) - (isMobile ? 15 : 20);
    charY = (cellHeight * 11) + (cellHeight / 2) - (isMobile ? 22 : 30);
    
    character.style.left = charX + 'px';
    character.style.top = charY + 'px';
    
    physicsActive = true;
  }, 100);
}

function switchToMainLevel() {
  currentLevel = 'main';
  studioLevel.classList.remove('active');
  mainLevel.classList.add('active');
  levelIndicator.textContent = 'Main Hub';
  
  velocityX = 0;
  velocityY = 0;
  isGrounded = false;
  physicsActive = false;
  
  requestAnimationFrame(() => {
    const arenaRect = gameArena.getBoundingClientRect();
    const cellWidth = arenaRect.width / 30;
    const cellHeight = arenaRect.height / 20;
    
    charX = (cellWidth * 15) - (isMobile ? 15 : 20);
    charY = (cellHeight * 10) - (isMobile ? 22 : 30);
    
    character.style.left = charX + 'px';
    character.style.top = charY + 'px';
    
    physicsActive = true;
  });
}

// Keyboard controls
window.addEventListener('keydown', (e) => {
  if (e.code in keys || e.code === 'Space') {
    e.preventDefault();
    if (e.code === 'Space') {
      keys.Space = true;
      checkDoorEntry();
    } else if (e.code === 'ArrowUp') {
      keys.ArrowUp = true;
      if (currentLevel === 'main' && isGrounded) {
        velocityY = JUMP_FORCE;
        isGrounded = false;
      }
    } else {
      keys[e.code] = true;
    }
  }
});

window.addEventListener('keyup', (e) => {
  if (e.code in keys || e.code === 'Space') {
    if (e.code === 'Space') {
      keys.Space = false;
    } else {
      keys[e.code] = false;
    }
  }
});

// ========== MOBILE TOUCH CONTROLS ==========
const dpadBtns = document.querySelectorAll('.dpad-btn');
const actionBtn = document.getElementById('actionBtn');

// D-Pad touch handling
dpadBtns.forEach(btn => {
  const keyCode = btn.dataset.key;
  
  btn.addEventListener('touchstart', (e) => {
    e.preventDefault();
    btn.classList.add('active');
    keys[keyCode] = true;
    
    // Handle jump on main level
    if (keyCode === 'ArrowUp' && currentLevel === 'main' && isGrounded) {
      velocityY = JUMP_FORCE;
      isGrounded = false;
    }
  }, { passive: false });
  
  btn.addEventListener('touchend', (e) => {
    e.preventDefault();
    btn.classList.remove('active');
    keys[keyCode] = false;
  }, { passive: false });
  
  btn.addEventListener('touchcancel', (e) => {
    btn.classList.remove('active');
    keys[keyCode] = false;
  });
});

// Action button handling (Enter/Jump)
actionBtn.addEventListener('touchstart', (e) => {
  e.preventDefault();
  actionBtn.classList.add('active');
  
  // Check if near door first
  const nearDoor = document.querySelector('.door.can-enter, .studio-door.can-enter');
  
  if (nearDoor) {
    // Enter door
    checkDoorEntry();
  } else if (currentLevel === 'main' && isGrounded) {
    // Jump in main level
    velocityY = JUMP_FORCE;
    isGrounded = false;
  }
}, { passive: false });

actionBtn.addEventListener('touchend', (e) => {
  e.preventDefault();
  actionBtn.classList.remove('active');
}, { passive: false });

// Update action button state based on door proximity
function updateActionButton() {
  const nearDoor = document.querySelector('.door.can-enter, .studio-door.can-enter');
  if (nearDoor) {
    actionBtn.classList.add('can-enter');
    actionBtn.textContent = 'Enter';
  } else {
    actionBtn.classList.remove('can-enter');
    actionBtn.textContent = currentLevel === 'main' ? 'Jump' : 'Enter';
  }
}

function getWalls() {
  if (currentLevel === 'main') {
    return Array.from(document.querySelectorAll('.main-grid-cell.wall'));
  } else {
    return Array.from(document.querySelectorAll('.grid-cell.wall'));
  }
}

function checkPlatformCollision(x, y, width, height) {
  const walls = getWalls();
  const arenaRect = gameArena.getBoundingClientRect();
  
  const charWidth = isMobile ? 30 : 40;
  const charHeight = isMobile ? 45 : 60;
  
  const charBox = {
    left: arenaRect.left + x,
    right: arenaRect.left + x + charWidth,
    top: arenaRect.top + y,
    bottom: arenaRect.top + y + charHeight
  };
  
  for (let wall of walls) {
    const wallRect = wall.getBoundingClientRect();
    
    if (charBox.bottom >= wallRect.top - 2 &&
        charBox.bottom <= wallRect.top + 15 &&
        charBox.right > wallRect.left + 5 &&
        charBox.left < wallRect.right - 5 &&
        velocityY >= 0) {
      return {
        collision: true,
        platformTop: wallRect.top - arenaRect.top
      };
    }
  }
  
  return { collision: false };
}

function isWallAt(x, y) {
  const arenaRect = gameArena.getBoundingClientRect();
  const charWidth = isMobile ? 30 : 40;
  const charHeight = isMobile ? 45 : 60;
  
  const margin = 6;
  const charBox = {
    left: arenaRect.left + x + margin,
    right: arenaRect.left + x + charWidth - margin,
    top: arenaRect.top + y + margin,
    bottom: arenaRect.top + y + charHeight - margin
  };
  
  const walls = getWalls();
  
  for (let wall of walls) {
    const wallRect = wall.getBoundingClientRect();
    
    const overlapping = !(
      charBox.right < wallRect.left ||
      charBox.left > wallRect.right ||
      charBox.bottom < wallRect.top ||
      charBox.top > wallRect.bottom
    );
    
    if (overlapping) {
      return true;
    }
  }
  
  return false;
}

function moveCharacter() {
  if (!isPoweredOn || !physicsActive) {
    requestAnimationFrame(moveCharacter);
    return;
  }
  
  const arenaRect = gameArena.getBoundingClientRect();
  const charWidth = isMobile ? 30 : 40;
  const charHeight = isMobile ? 45 : 60;
  const moveSpeed = isMobile ? 4 : MOVE_SPEED;
  
  if (currentLevel === 'main') {
    if (keys.ArrowLeft) {
      velocityX = -moveSpeed;
    } else if (keys.ArrowRight) {
      velocityX = moveSpeed;
    } else {
      velocityX = 0;
    }
    
    if (!isGrounded) {
      velocityY += GRAVITY;
      if (velocityY > MAX_FALL_SPEED) {
        velocityY = MAX_FALL_SPEED;
      }
    }
    
    let newX = charX + velocityX;
    let newY = charY + velocityY;
    
    if (newX < 5) newX = 5;
    if (newX > arenaRect.width - charWidth - 5) newX = arenaRect.width - charWidth - 5;
    
    if (!isWallAt(newX, charY)) {
      charX = newX;
    } else {
      velocityX = 0;
    }
    
    const collision = checkPlatformCollision(charX, newY, charWidth, charHeight);
    
    if (collision.collision) {
      charY = collision.platformTop - charHeight + 2;
      velocityY = 0;
      isGrounded = true;
    } else {
      if (!isWallAt(charX, newY)) {
        charY = newY;
        isGrounded = false;
      } else {
        if (velocityY > 0) {
          velocityY = 0;
          isGrounded = true;
        }
      }
    }
    
    if (charY > arenaRect.height - charHeight - 5) {
      charY = arenaRect.height - charHeight - 5;
      velocityY = 0;
      isGrounded = true;
    }
    
    if (isGrounded) {
      const stillOnGround = checkPlatformCollision(charX, charY + 2, charWidth, charHeight);
      if (!stillOnGround.collision && charY < arenaRect.height - charHeight - 5) {
        isGrounded = false;
      }
    }
    
  } else {
    let newX = charX;
    let newY = charY;
    const speed = isMobile ? 3 : 4;
    
    if (keys.ArrowLeft && charX > 5) {
      newX = charX - speed;
    }
    if (keys.ArrowRight && charX < arenaRect.width - charWidth - 5) {
      newX = charX + speed;
    }
    if (keys.ArrowUp && charY > 5) {
      newY = charY - speed;
    }
    if (keys.ArrowDown && charY < arenaRect.height - charHeight - 5) {
      newY = charY + speed;
    }
    
    if (!isWallAt(newX, charY)) {
      charX = newX;
    }
    
    if (!isWallAt(charX, newY)) {
      charY = newY;
    }
  }
  
  character.style.left = charX + 'px';
  character.style.top = charY + 'px';
  
  checkDoorCollision();
  updateActionButton();
  requestAnimationFrame(moveCharacter);
}

function checkDoorCollision() {
  const charRect = character.getBoundingClientRect();
  
  if (currentLevel === 'main') {
    const doors = document.querySelectorAll('.door');
    doors.forEach(door => {
      updateDoorState(door, isColliding(charRect, door.getBoundingClientRect()));
    });
  } else {
    const studioDoors = document.querySelectorAll('.studio-door');
    studioDoors.forEach(door => {
      updateDoorState(door, isColliding(charRect, door.getBoundingClientRect()));
    });
  }
}

function updateDoorState(door, colliding) {
  if (colliding) {
    door.classList.add('can-enter');
  } else {
    door.classList.remove('can-enter');
  }
}

function isColliding(rect1, rect2) {
  return !(rect1.right < rect2.left || 
           rect1.left > rect2.right || 
           rect1.bottom < rect2.top || 
           rect1.top > rect2.bottom);
}

function checkDoorEntry() {
  let activeDoor;
  
  if (currentLevel === 'main') {
    activeDoor = document.querySelector('.door.can-enter');
  } else {
    activeDoor = document.querySelector('.studio-door.can-enter');
  }
  
  if (activeDoor) {
    const doorType = activeDoor.dataset.type;
    
    if (doorType === 'studio') {
      switchToStudioLevel();
    } else if (doorType === 'back') {
      switchToMainLevel();
    } else {
      enterDoor(doorType);
    }
  }
}

function enterDoor(doorType) {
  console.log(`Entering ${doorType}...`);
  
  switch(doorType) {
    case 'repository':
      window.location.href = 'repository.html';
      break;
    case 'home':
      window.location.href = 'index2.html';
      break;
    case 'about':
      window.location.href = 'about.html';
      break;
    case 'illustrations':
      window.location.href = 'illustrations.html';
      break;
    case 'branding':
      window.location.href = 'logobranding.html';
      break;
    case 'webdesign':
      window.location.href = 'webdesign.html';
      break;
    case 'film':
      window.location.href = 'film.html';
      break;
    case '3dart':
      window.location.href = '3d-art.html';
      break;
  }
}

moveCharacter();

// Mouse trail effect (desktop only)
if (!isMobile) {
  new p5((p) => {
    let trails = [];
    
    p.setup = () => {
      const canvas = p.createCanvas(p.windowWidth, p.windowHeight);
      canvas.position(0, 0);
      canvas.style('pointer-events', 'none');
      canvas.style('z-index', '1');
      canvas.style('position', 'fixed');
      canvas.style('top', '0');
      canvas.style('left', '0');
      p.clear();
      p.noStroke();
    };

    p.draw = () => {
      p.clear();
      
      for (let i = trails.length - 1; i >= 0; i--) {
        const point = trails[i];
        
        p.fill(255, 255, 255, point.alpha * 0.08);
        p.ellipse(point.x, point.y, point.size * 2);
        
        p.fill(255, 255, 255, point.alpha * 0.3);
        p.ellipse(point.x, point.y, point.size);
        
        point.alpha -= 3;
        point.size *= 0.96;
        if (point.alpha <= 0) trails.splice(i, 1);
      }

      const d = p.dist(p.mouseX, p.mouseY, p.pmouseX, p.pmouseY);
      if (d > 0) {
        const steps = p.max(1, d * 0.5);
        for (let i = 0; i <= steps; i++) {
          const t = i / steps;
          const x = p.lerp(p.pmouseX, p.mouseX, t);
          const y = p.lerp(p.pmouseY, p.mouseY, t);
          trails.push({
            x,
            y,
            size: p.random(6, 10),
            alpha: p.random(120, 150)
          });
        }
      }

      if (trails.length > 600) trails.splice(0, trails.length - 600);
    };

    p.windowResized = () => {
      p.resizeCanvas(p.windowWidth, p.windowHeight);
    };
  });
}
</script>
</body>
</html>